---
kind: DatasetSnapshot
version: 1
content:
  name: account.tokens.transfers
  kind: Root
  metadata:
    - kind: SetPollingSource
      fetch:
        kind: Url
        url: "https://api.etherscan.io/v2/api\
          ?chainid=1\
          &module=account\
          &action=tokentx\
          &address=0xeadb3840596cabf312f2bc88a4bb0b93a4e1ff5f\
          &page=1\
          &offset=1000\
          &startblock=0\
          &endblock=99999999\
          &apikey=${{ env.ETHERSCAN_API_KEY }}"
      read:
        kind: Json
        subPath: result
      preprocess:
        kind: Sql
        engine: datafusion
        query: |
          SELECT
            to_timestamp_seconds(cast(timeStamp as bigint)) as block_time,
            cast(blockNumber as bigint) as block_number,
            blockHash as block_hash,
            hash as transaction_hash,
            transactionIndex as transaction_index,
            nonce,
            "from",
            to,
            value,
            contractAddress as contract_address,
            tokenName as token_name,
            tokenSymbol as token_symbol,
            tokenDecimal as token_decimal,
            gas,
            gasPrice as gas_price,
            gasUsed as gas_used,
            cumulativeGasUsed as cumulative_gas_used,
            confirmations
          FROM input
      merge:
        kind: Ledger
        primaryKey:
          - transaction_hash
    - kind: SetVocab
      eventTimeColumn: block_time

---
kind: DatasetSnapshot
version: 1
content:
  name: net.rocketpool.reth.mint-burn
  kind: root
  metadata:
    - kind: setPollingSource
      fetch:
        kind: container
        image: "ghcr.io/kamu-data/fetch-net.rocketpool.reth.mint-burn:0.1.1"
        env:
          - name: ETH_NODE_PROVIDER_URL
          - name: STRIDE
            value: "10000"
      read:
        kind: ndJson
      preprocess:
        kind: sql
        engine: datafusion
        query: |
          SELECT
            'rETH' as token_symbol,
            "eventName" as event_name,
            cast("amount" as double) / pow(10.0, 18) as amount,
            cast("ethAmount" as double) / pow(10.0, 18) as eth_amount,
            "blockNumber" as block_number,
            "blockHash" as block_hash,
            to_timestamp_seconds("blockTime") as block_time,
            "transactionIndex" as transaction_index,
            "transactionHash" as transaction_hash,
            "logIndex" as log_index
          FROM input
      merge:
        kind: ledger
        primaryKey:
          - transaction_hash
    - kind: setVocab
      eventTimeColumn: block_time

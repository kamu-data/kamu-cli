{
  "db_name": "PostgreSQL",
  "query": "\n            WITH bindings AS (\n                SELECT\n                    (binding->>'flow_type')::text AS flow_type,\n                    (binding->'scope_data')::jsonb AS scope_data\n                FROM jsonb_array_elements($1::jsonb) AS binding\n            ),\n            finished AS (\n                SELECT\n                    b.flow_type,\n                    b.scope_data,\n                    e.event_id,\n                    (e.event_payload #>> '{TaskFinished,task_outcome,Success}') IS NOT NULL AS is_success,\n                    (e.event_payload #>> '{TaskFinished,task_outcome,Failed}') IS NOT NULL AS is_failed\n                FROM flow_events e\n                JOIN flows f ON f.flow_id = e.flow_id\n                JOIN bindings b ON b.flow_type = f.flow_type AND b.scope_data = f.scope_data\n                WHERE e.event_type = 'FlowEventTaskFinished'\n            ),\n            last_success AS (\n                SELECT\n                    flow_type,\n                    scope_data,\n                    MAX(event_id) AS event_id\n                FROM finished\n                WHERE is_success\n                GROUP BY flow_type, scope_data\n            )\n            SELECT\n                f.flow_type as \"flow_type: String\",\n                f.scope_data,\n                COUNT(*)::bigint AS consecutive_failures\n            FROM finished f\n            LEFT JOIN last_success ls ON ls.flow_type = f.flow_type AND ls.scope_data = f.scope_data\n            WHERE f.is_failed AND f.event_id > COALESCE(ls.event_id, 0)\n            GROUP BY f.flow_type, f.scope_data\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "flow_type: String",
        "type_info": "Text"
      },
      {
        "ordinal": 1,
        "name": "scope_data",
        "type_info": "Jsonb"
      },
      {
        "ordinal": 2,
        "name": "consecutive_failures",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Jsonb"
      ]
    },
    "nullable": [
      null,
      null,
      null
    ]
  },
  "hash": "5b558f762047412ca301d964337765f35b81d5c13c1350a980a6ab802ea6edbb"
}
